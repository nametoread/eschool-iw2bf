parameters:
  - name: azureConnection
    default: ""
  - name: rgName
    default: ""
  - name: file
    default: ""
  - name: params
    default: ""

stages:
  - stage: Deploy
    jobs:
      - job: Deploy
        steps:
          - task: AzureCLI@2
            name: Deploy
            displayName: Deploy base infrastructure to Azure
            inputs:
              azureSubscription: ${{ parameters.azureConnection }}
              scriptType: "bash"
              scriptLocation: "inlineScript"
              inlineScript: |
                az deployment group create \
                  --name dep-missionctl-$(Build.BuildNumber) \
                  --resource-group ${{ parameters.rgName }} \
                  --template-file ${{ parameters.file }} \
                  --parameters ${{ parameters.params }}

                az deployment group show \
                  --name dep-missionctl-$(Build.BuildNumber) \
                  --resource-group ${{ parameters.rgName }} \
                  --query properties.outputs.crName
